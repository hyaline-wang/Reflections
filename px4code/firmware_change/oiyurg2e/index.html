<!doctype html><html lang="zh-CN"><head><meta charset="utf-8" /><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="generator" content="VuePress 2.0.0-rc.18" /><meta name="theme" content="VuePress Theme Plume " /><script id="check-mac-os">document.documentElement.classList.toggle('mac', /Mac|iPhone|iPod|iPad/i.test(navigator.platform))</script><script id="check-dark-mode">;(function () {const um= localStorage.getItem('vuepress-theme-appearance') || 'auto';const sm = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;const isDark = um === 'dark' || (um !== 'light' && sm);document.documentElement.dataset.theme = isDark ? 'dark' : 'light';})();</script><meta property="og:url" content="https://hyaline.qyswarm.top/px4code/firmware_change/oiyurg2e/"><meta property="og:site_name" content="Reflections of Hyaline"><meta property="og:title" content="固件修改记录"><meta property="og:description" content="VINS 兼容的修改 为了让VINS数据可用作为vision_pose传给px4的EKF，需要做以下修改 MAVLINK默认回传频率修改 修改 默认Mavlink部分消息发送频率 相关信息 频率修改的位置不同版本有变化,以USB连接为例 v1.13 MAVLINK_MODE_CONFIG v1.15 MAVLINK_MODE_ONBOARD TODO ..."><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2024-10-20T14:14:17.000Z"><meta property="article:modified_time" content="2024-10-20T14:14:17.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"固件修改记录","image":[""],"dateModified":"2024-10-20T14:14:17.000Z","author":[]}</script><title>固件修改记录 | Reflections of Hyaline</title><meta name="description" content="VINS 兼容的修改 为了让VINS数据可用作为vision_pose传给px4的EKF，需要做以下修改 MAVLINK默认回传频率修改 修改 默认Mavlink部分消息发送频率 相关信息 频率修改的位置不同版本有变化,以USB连接为例 v1.13 MAVLINK_MODE_CONFIG v1.15 MAVLINK_MODE_ONBOARD TODO ..."><link rel="preload" href="/assets/style-DgmyGy5d.css" as="style"><link rel="stylesheet" href="/assets/style-DgmyGy5d.css"><link rel="modulepreload" href="/assets/app-vo1rYq2c.js"><link rel="modulepreload" href="/assets/index.html-QbEEvpWM.js"><link rel="prefetch" href="/assets/index.html-YFTfTYVL.js" as="script"><link rel="prefetch" href="/assets/index.html-Pup59qdI.js" as="script"><link rel="prefetch" href="/assets/index.html-DGWbbfUq.js" as="script"><link rel="prefetch" href="/assets/index.html-s9gnD4o4.js" as="script"><link rel="prefetch" href="/assets/index.html-YE6mHZl5.js" as="script"><link rel="prefetch" href="/assets/index.html-BocoaVVL.js" as="script"><link rel="prefetch" href="/assets/index.html-DRhSKV_l.js" as="script"><link rel="prefetch" href="/assets/index.html-DOhL2bqj.js" as="script"><link rel="prefetch" href="/assets/index.html-CKzeLscq.js" as="script"><link rel="prefetch" href="/assets/index.html-BrwCI7Oq.js" as="script"><link rel="prefetch" href="/assets/index.html-C6uKvetb.js" as="script"><link rel="prefetch" href="/assets/index.html-BwHnbshc.js" as="script"><link rel="prefetch" href="/assets/index.html-BCG9Qu-k.js" as="script"><link rel="prefetch" href="/assets/index.html-Cy_cR5sg.js" as="script"><link rel="prefetch" href="/assets/index.html-CxpbJHUM.js" as="script"><link rel="prefetch" href="/assets/index.html-CzcaZNFa.js" as="script"><link rel="prefetch" href="/assets/index.html-Cw_K8emj.js" as="script"><link rel="prefetch" href="/assets/index.html-B3JRsW1x.js" as="script"><link rel="prefetch" href="/assets/index.html-DTSOnIby.js" as="script"><link rel="prefetch" href="/assets/index.html-CpcPx4Jn.js" as="script"><link rel="prefetch" href="/assets/index.html-CUgATDQa.js" as="script"><link rel="prefetch" href="/assets/index.html-CPQ3yyEE.js" as="script"><link rel="prefetch" href="/assets/index.html-Bk501f1F.js" as="script"><link rel="prefetch" href="/assets/index.html-CPvt3ROF.js" as="script"><link rel="prefetch" href="/assets/index.html--_br75Le.js" as="script"><link rel="prefetch" href="/assets/index.html-CBgYB9Xz.js" as="script"><link rel="prefetch" href="/assets/index.html-mTBx31Za.js" as="script"><link rel="prefetch" href="/assets/index.html-Rucsrau8.js" as="script"><link rel="prefetch" href="/assets/index.html-qEf85Hdf.js" as="script"><link rel="prefetch" href="/assets/index.html-D7xS_OCD.js" as="script"><link rel="prefetch" href="/assets/index.html-CTJxgAHy.js" as="script"><link rel="prefetch" href="/assets/index.html-C_xTeC95.js" as="script"><link rel="prefetch" href="/assets/index.html-9PLu3VZd.js" as="script"><link rel="prefetch" href="/assets/index.html-DmbF9Rbu.js" as="script"><link rel="prefetch" href="/assets/index.html-6fSUjEsq.js" as="script"><link rel="prefetch" href="/assets/index.html-2VuPYIn6.js" as="script"><link rel="prefetch" href="/assets/index.html-DBUG--Fd.js" as="script"><link rel="prefetch" href="/assets/index.html-C7LAil-L.js" as="script"><link rel="prefetch" href="/assets/index.html-Sz1LQbuj.js" as="script"><link rel="prefetch" href="/assets/index.html-Ben9S_NZ.js" as="script"><link rel="prefetch" href="/assets/index.html-BRROz67N.js" as="script"><link rel="prefetch" href="/assets/index.html-WoYopY8I.js" as="script"><link rel="prefetch" href="/assets/index.html-CN3vYjF0.js" as="script"><link rel="prefetch" href="/assets/index.html-DwgLXnA4.js" as="script"><link rel="prefetch" href="/assets/index.html-C9sr_P3Z.js" as="script"><link rel="prefetch" href="/assets/index.html-CnpdF1oy.js" as="script"><link rel="prefetch" href="/assets/index.html-B2vM8j54.js" as="script"><link rel="prefetch" href="/assets/index.html-C8o9hyy_.js" as="script"><link rel="prefetch" href="/assets/index.html-Di0sGJs-.js" as="script"><link rel="prefetch" href="/assets/index.html-BaCyXFb6.js" as="script"><link rel="prefetch" href="/assets/index.html-C3extoi-.js" as="script"><link rel="prefetch" href="/assets/index.html-DmEM0sdE.js" as="script"><link rel="prefetch" href="/assets/index.html-CibPn-gp.js" as="script"><link rel="prefetch" href="/assets/index.html-C7ZPw5EP.js" as="script"><link rel="prefetch" href="/assets/index.html-BTCjnC_o.js" as="script"><link rel="prefetch" href="/assets/index.html-CICZbSEx.js" as="script"><link rel="prefetch" href="/assets/index.html-DjW4iVwC.js" as="script"><link rel="prefetch" href="/assets/index.html-9DPUPNFE.js" as="script"><link rel="prefetch" href="/assets/index.html-CCAfvkvf.js" as="script"><link rel="prefetch" href="/assets/index.html-D539JpCM.js" as="script"><link rel="prefetch" href="/assets/index.html-DB9_wBgV.js" as="script"><link rel="prefetch" href="/assets/index.html-827a9L7H.js" as="script"><link rel="prefetch" href="/assets/index.html-ThrKtBFe.js" as="script"><link rel="prefetch" href="/assets/index.html-BsbENsPE.js" as="script"><link rel="prefetch" href="/assets/index.html-CSIRbYJb.js" as="script"><link rel="prefetch" href="/assets/index.html-ox3U4555.js" as="script"><link rel="prefetch" href="/assets/index.html-ChswU8gF.js" as="script"><link rel="prefetch" href="/assets/index.html-DUhRNEzm.js" as="script"><link rel="prefetch" href="/assets/index.html-b0XZHukd.js" as="script"><link rel="prefetch" href="/assets/index.html-m47Gbtdh.js" as="script"><link rel="prefetch" href="/assets/index.html-CDofdTCF.js" as="script"><link rel="prefetch" href="/assets/index.html-Do0QXJiF.js" as="script"><link rel="prefetch" href="/assets/index.html-CYCtWkYp.js" as="script"><link rel="prefetch" href="/assets/index.html-D58uA96e.js" as="script"><link rel="prefetch" href="/assets/index.html-CEKv6FWM.js" as="script"><link rel="prefetch" href="/assets/index.html-J4IrfsVa.js" as="script"><link rel="prefetch" href="/assets/index.html-B7YYCuMI.js" as="script"><link rel="prefetch" href="/assets/index.html-CY5EV3Pf.js" as="script"><link rel="prefetch" href="/assets/index.html-BvKMiF69.js" as="script"><link rel="prefetch" href="/assets/index.html-CWdWbB0k.js" as="script"><link rel="prefetch" href="/assets/index.html-C3qlmsnm.js" as="script"><link rel="prefetch" href="/assets/index.html-CpfwG6AS.js" as="script"><link rel="prefetch" href="/assets/index.html-DWF_ZgMN.js" as="script"><link rel="prefetch" href="/assets/index.html-B0yMU8Ae.js" as="script"><link rel="prefetch" href="/assets/index.html-Dj59aYZx.js" as="script"><link rel="prefetch" href="/assets/404.html-Cm2XlB5y.js" as="script"><link rel="prefetch" href="/assets/index.html-DVBfIE31.js" as="script"><link rel="prefetch" href="/assets/index.html-BahB3UBo.js" as="script"><link rel="prefetch" href="/assets/index.html-CO3YfsUg.js" as="script"><link rel="prefetch" href="/assets/index.html-lj2sZhwL.js" as="script"><link rel="prefetch" href="/assets/index.html-B0KCv7hE.js" as="script"><link rel="prefetch" href="/assets/index.html-DX6ZFXp-.js" as="script"><link rel="prefetch" href="/assets/index.html-DNOWRWYu.js" as="script"><link rel="prefetch" href="/assets/index.html-O7Mm7Zu-.js" as="script"><link rel="prefetch" href="/assets/photoswipe.esm-GXRgw7eJ.js" as="script"><link rel="prefetch" href="/assets/searchBox-default-crBdcbpm.js" as="script"><link rel="prefetch" href="/assets/searchBox-en-DMYsc42c.js" as="script"><link rel="prefetch" href="/assets/SearchBox-CTCSqa4w.js" as="script"><link rel="prefetch" href="/assets/setupDevtools-7MC2TMWH-BQ4YBpmm.js" as="script"></head><body><div id="app"><!--[--><div class="theme-plume vp-layout" vp-container data-v-72347141><!--[--><!--[--><!--]--><!--[--><span tabindex="-1" data-v-b61813ab></span><a href="#VPContent" class="vp-skip-link visually-hidden" data-v-b61813ab> Skip to content </a><!--]--><!----><header class="vp-nav" data-v-72347141 data-v-41315436><div class="vp-navbar" vp-navbar data-v-41315436 data-v-2b21c2ff><div class="wrapper" data-v-2b21c2ff><div class="container" data-v-2b21c2ff><div class="title" data-v-2b21c2ff><div class="vp-navbar-title has-sidebar" data-v-2b21c2ff data-v-3eca8829><a class="vp-link no-icon link title" href="/" data-v-3eca8829 data-v-85010ec6><!--[--><!--[--><!--]--><!--[--><!--[--><!--[--><img class="vp-image dark logo" src="/notebook.svg" alt data-v-94c9c0fc><!--]--><!--[--><img class="vp-image light logo" src="/notebook.svg" alt data-v-94c9c0fc><!--]--><!--]--><!--]--><span data-v-3eca8829>Reflections of Hyaline</span><!--[--><!--]--><!--]--><!----></a></div></div><div class="content" data-v-2b21c2ff><div class="content-body" data-v-2b21c2ff><!--[--><!--]--><div class="vp-navbar-search search" data-v-2b21c2ff><div class="search-wrapper" data-v-c5119475><!----><div id="local-search" data-v-c5119475><button type="button" class="mini-search mini-search-button" aria-label="搜索文档" data-v-c5119475><span class="mini-search-button-container"><svg class="mini-search-search-icon" width="20" height="20" viewBox="0 0 20 20" aria-label="search icon"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="mini-search-button-placeholder">搜索文档</span></span><span class="mini-search-button-keys"><kbd class="mini-search-button-key"></kbd><kbd class="mini-search-button-key">K</kbd></span></button></div></div></div><nav aria-labelledby="main-nav-aria-label" class="vp-navbar-menu menu" data-v-2b21c2ff data-v-276dd622><span id="main-nav-aria-label" class="visually-hidden" data-v-276dd622>Main Navigation</span><!--[--><!--[--><a class="vp-link no-icon link navbar-menu-link" href="/" tabindex="0" data-v-276dd622 data-v-f33fd5ec data-v-85010ec6><!--[--><!----><span data-v-f33fd5ec>首页</span><!--]--><!----></a><!--]--><!--[--><a class="vp-link no-icon link navbar-menu-link" href="/blog/" tabindex="0" data-v-276dd622 data-v-f33fd5ec data-v-85010ec6><!--[--><!----><span data-v-f33fd5ec>博客</span><!--]--><!----></a><!--]--><!--[--><div class="vp-flyout vp-navbar-menu-group" data-v-276dd622 data-v-bbc6bb98><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-bbc6bb98><span class="text" data-v-bbc6bb98><!----><!----><span data-v-bbc6bb98>笔记</span><span class="vpi-chevron-down text-icon" data-v-bbc6bb98></span></span></button><div class="menu" data-v-bbc6bb98><div class="vp-menu" data-v-bbc6bb98 data-v-d593d810><div class="items" data-v-d593d810><!--[--><!--[--><div class="vp-menu-link" data-v-d593d810 data-v-09ee1cd6><a class="vp-link no-icon link" href="/px4code/" data-v-09ee1cd6 data-v-85010ec6><!--[--><!----> px4源码解析<!--]--><!----></a></div><!--]--><!--[--><div class="vp-menu-link" data-v-d593d810 data-v-09ee1cd6><a class="vp-link no-icon link" href="/linux_base/" data-v-09ee1cd6 data-v-85010ec6><!--[--><!----> linux基础<!--]--><!----></a></div><!--]--><!--[--><div class="vp-menu-link" data-v-d593d810 data-v-09ee1cd6><a class="vp-link no-icon link" href="/robot_base/" data-v-09ee1cd6 data-v-85010ec6><!--[--><!----> 机器人基础<!--]--><!----></a></div><!--]--><!--[--><div class="vp-menu-link" data-v-d593d810 data-v-09ee1cd6><a class="vp-link no-icon link" href="/normal_hw/rtk/eiwjd104/" data-v-09ee1cd6 data-v-85010ec6><!--[--><!----> 硬件文档<!--]--><!----></a></div><!--]--><!--[--><div class="vp-menu-link" data-v-d593d810 data-v-09ee1cd6><a class="vp-link no-icon link" href="/easy_server_manage/user_manage/tgm1160i/" data-v-09ee1cd6 data-v-85010ec6><!--[--><!----> 简易服务器管理<!--]--><!----></a></div><!--]--><!--[--><div class="vp-menu-link" data-v-d593d810 data-v-09ee1cd6><a class="vp-link no-icon link" href="/production_doc/X152b/27023b50/" data-v-09ee1cd6 data-v-85010ec6><!--[--><!----> 生产文档<!--]--><!----></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--]--></nav><div class="vp-flyout vp-navbar-translations translations" data-v-2b21c2ff data-v-9d522f1a data-v-bbc6bb98><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="选择语言" data-v-bbc6bb98><span class="text" data-v-bbc6bb98><!----><span class="vpi-languages option-icon" data-v-bbc6bb98></span><!----><span class="vpi-chevron-down text-icon" data-v-bbc6bb98></span></span></button><div class="menu" data-v-bbc6bb98><div class="vp-menu" data-v-bbc6bb98 data-v-d593d810><!----><!--[--><!--[--><div class="items" data-v-9d522f1a><p class="title" data-v-9d522f1a>简体中文</p><!--[--><div class="vp-menu-link" data-v-9d522f1a data-v-09ee1cd6><a class="vp-link no-icon link" href="/en/" data-v-09ee1cd6 data-v-85010ec6><!--[--><!----> English<!--]--><!----></a></div><!--]--></div><!--]--><!--]--></div></div></div><div class="vp-navbar-appearance appearance" data-v-2b21c2ff data-v-5c9adf83><button class="vp-switch vp-switch-appearance" type="button" role="switch" title aria-checked="false" data-v-5c9adf83 data-v-602d4382 data-v-e1ec7bca><span class="check" data-v-e1ec7bca><span class="icon" data-v-e1ec7bca><!--[--><span class="vpi-sun sun" data-v-602d4382></span><span class="vpi-moon moon" data-v-602d4382></span><!--]--></span></span></button></div><!----><div class="vp-flyout vp-navbar-extra extra" data-v-2b21c2ff data-v-b15af674 data-v-bbc6bb98><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-bbc6bb98><span class="vpi-more-horizontal icon" data-v-bbc6bb98></span></button><div class="menu" data-v-bbc6bb98><div class="vp-menu" data-v-bbc6bb98 data-v-d593d810><!----><!--[--><!--[--><div class="group translations" data-v-b15af674><p class="trans-title" data-v-b15af674>简体中文</p><!--[--><div class="vp-menu-link" data-v-b15af674 data-v-09ee1cd6><a class="vp-link no-icon link" href="/en/" data-v-09ee1cd6 data-v-85010ec6><!--[--><!----> English<!--]--><!----></a></div><!--]--></div><div class="group" data-v-b15af674><div class="item appearance" data-v-b15af674><p class="label" data-v-b15af674>外观</p><div class="appearance-action" data-v-b15af674><button class="vp-switch vp-switch-appearance" type="button" role="switch" title aria-checked="false" data-v-b15af674 data-v-602d4382 data-v-e1ec7bca><span class="check" data-v-e1ec7bca><span class="icon" data-v-e1ec7bca><!--[--><span class="vpi-sun sun" data-v-602d4382></span><span class="vpi-moon moon" data-v-602d4382></span><!--]--></span></span></button></div></div></div><!----><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="vp-navbar-hamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="nav-screen" data-v-2b21c2ff data-v-82a94bf0><span class="container" data-v-82a94bf0><span class="top" data-v-82a94bf0></span><span class="middle" data-v-82a94bf0></span><span class="bottom" data-v-82a94bf0></span></span></button></div></div></div></div><div class="divider" data-v-2b21c2ff><div class="divider-line" data-v-2b21c2ff></div></div></div><!----></header><div class="vp-local-nav reached-top is-blog" data-v-72347141 data-v-35bda670><button class="menu" aria-expanded="false" aria-controls="SidebarNav" data-v-35bda670><span class="vpi-align-left menu-icon" data-v-35bda670></span><span class="menu-text" data-v-35bda670>Menu</span></button><div class="vp-local-nav-outline-dropdown" style="--vp-vh:0px;" data-v-35bda670 data-v-ff9d5504><button data-v-ff9d5504>返回顶部</button><!----></div></div><aside class="vp-sidebar" vp-sidebar data-v-72347141 data-v-cdebdfd8><div class="curtain" data-v-cdebdfd8></div><nav id="SidebarNav" class="nav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-cdebdfd8><span id="sidebar-aria-label" class="visually-hidden" data-v-cdebdfd8> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-27da67de><section class="vp-sidebar-item sidebar-item level-0" data-v-27da67de data-v-4d095593><!----><div class="items" data-v-4d095593><!--[--><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-4d095593 data-v-4d095593><div class="item" data-v-4d095593><div class="indicator" data-v-4d095593></div><!----><a class="vp-link no-icon link link" href="/px4code/" data-v-4d095593 data-v-85010ec6><!--[--><p class="text" data-v-4d095593>飞控源码</p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-4d095593 data-v-4d095593><div class="item" data-v-4d095593><div class="indicator" data-v-4d095593></div><!----><a class="vp-link no-icon link link" href="/s26d5kdj/" data-v-4d095593 data-v-85010ec6><!--[--><p class="text" data-v-4d095593>参数调试</p><!--]--><!----></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-27da67de><section class="vp-sidebar-item sidebar-item level-0 collapsible" data-v-27da67de data-v-4d095593><div class="item" role="button" tabindex="0" data-v-4d095593><div class="indicator" data-v-4d095593></div><!----><h2 class="text" data-v-4d095593>代码构建</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-4d095593><span class="vpi-chevron-right caret-icon" data-v-4d095593></span></div></div><div class="items" data-v-4d095593><!--[--><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-4d095593 data-v-4d095593><div class="item" data-v-4d095593><div class="indicator" data-v-4d095593></div><!----><a class="vp-link no-icon link link" href="/px4code/wno3ydw8/" data-v-4d095593 data-v-85010ec6><!--[--><p class="text" data-v-4d095593>构建px4 docker环境</p><!--]--><!----></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-27da67de><section class="vp-sidebar-item sidebar-item level-0 collapsible has-active" data-v-27da67de data-v-4d095593><div class="item" role="button" tabindex="0" data-v-4d095593><div class="indicator" data-v-4d095593></div><!----><h2 class="text" data-v-4d095593>固件修改</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-4d095593><span class="vpi-chevron-right caret-icon" data-v-4d095593></span></div></div><div class="items" data-v-4d095593><!--[--><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-4d095593 data-v-4d095593><div class="item" data-v-4d095593><div class="indicator" data-v-4d095593></div><!----><a class="vp-link no-icon link link" href="/px4code/firmware_change/oiyurg2e/" data-v-4d095593 data-v-85010ec6><!--[--><p class="text" data-v-4d095593>固件修改记录</p><!--]--><!----></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-27da67de><section class="vp-sidebar-item sidebar-item level-0 collapsible" data-v-27da67de data-v-4d095593><div class="item" role="button" tabindex="0" data-v-4d095593><div class="indicator" data-v-4d095593></div><!----><h2 class="text" data-v-4d095593>控制器</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-4d095593><span class="vpi-chevron-right caret-icon" data-v-4d095593></span></div></div><div class="items" data-v-4d095593><!--[--><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-4d095593 data-v-4d095593><div class="item" data-v-4d095593><div class="indicator" data-v-4d095593></div><!----><a class="vp-link no-icon link link" href="/px4code/controller/iejazgwj/" data-v-4d095593 data-v-85010ec6><!--[--><p class="text" data-v-4d095593>AttiControl</p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-4d095593 data-v-4d095593><div class="item" data-v-4d095593><div class="indicator" data-v-4d095593></div><!----><a class="vp-link no-icon link link" href="/px4code/controller/4dbuxj2w/" data-v-4d095593 data-v-85010ec6><!--[--><p class="text" data-v-4d095593>参数自优化</p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-4d095593 data-v-4d095593><div class="item" data-v-4d095593><div class="indicator" data-v-4d095593></div><!----><a class="vp-link no-icon link link" href="/px4code/controller/pwlltgw1/" data-v-4d095593 data-v-85010ec6><!--[--><p class="text" data-v-4d095593>ctrl_freq</p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-4d095593 data-v-4d095593><div class="item" data-v-4d095593><div class="indicator" data-v-4d095593></div><!----><a class="vp-link no-icon link link" href="/px4code/controller/xyb3tlxm/" data-v-4d095593 data-v-85010ec6><!--[--><p class="text" data-v-4d095593>z_axis_ctrl</p><!--]--><!----></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-27da67de><section class="vp-sidebar-item sidebar-item level-0 collapsible" data-v-27da67de data-v-4d095593><div class="item" role="button" tabindex="0" data-v-4d095593><div class="indicator" data-v-4d095593></div><!----><h2 class="text" data-v-4d095593>滤波器</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-4d095593><span class="vpi-chevron-right caret-icon" data-v-4d095593></span></div></div><div class="items" data-v-4d095593><!--[--><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-4d095593 data-v-4d095593><div class="item" data-v-4d095593><div class="indicator" data-v-4d095593></div><!----><a class="vp-link no-icon link link" href="/px4code/ti2v4oag/" data-v-4d095593 data-v-85010ec6><!--[--><p class="text" data-v-4d095593>EKF高度估计</p><!--]--><!----></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-27da67de><section class="vp-sidebar-item sidebar-item level-0 collapsible" data-v-27da67de data-v-4d095593><div class="item" role="button" tabindex="0" data-v-4d095593><div class="indicator" data-v-4d095593></div><!----><h2 class="text" data-v-4d095593>通讯SDK</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-4d095593><span class="vpi-chevron-right caret-icon" data-v-4d095593></span></div></div><div class="items" data-v-4d095593><!--[--><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-4d095593 data-v-4d095593><div class="item" data-v-4d095593><div class="indicator" data-v-4d095593></div><!----><a class="vp-link no-icon link link" href="/kxtk2ysd/" data-v-4d095593 data-v-85010ec6><!--[--><p class="text" data-v-4d095593>mavros</p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-4d095593 data-v-4d095593><div class="item" data-v-4d095593><div class="indicator" data-v-4d095593></div><!----><a class="vp-link no-icon link link" href="/z8hnf86d/" data-v-4d095593 data-v-85010ec6><!--[--><p class="text" data-v-4d095593>qgc</p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-4d095593 data-v-4d095593><div class="item" data-v-4d095593><div class="indicator" data-v-4d095593></div><!----><a class="vp-link no-icon link link" href="/sizznice/" data-v-4d095593 data-v-85010ec6><!--[--><p class="text" data-v-4d095593>vision_pose</p><!--]--><!----></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-27da67de><section class="vp-sidebar-item sidebar-item level-0 collapsible" data-v-27da67de data-v-4d095593><div class="item" role="button" tabindex="0" data-v-4d095593><div class="indicator" data-v-4d095593></div><!----><h2 class="text" data-v-4d095593>飞行模式</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-4d095593><span class="vpi-chevron-right caret-icon" data-v-4d095593></span></div></div><div class="items" data-v-4d095593><!--[--><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-4d095593 data-v-4d095593><div class="item" data-v-4d095593><div class="indicator" data-v-4d095593></div><!----><a class="vp-link no-icon link link" href="/px4code/lx82vmmh/" data-v-4d095593 data-v-85010ec6><!--[--><p class="text" data-v-4d095593>Px4Mode</p><!--]--><!----></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-27da67de><section class="vp-sidebar-item sidebar-item level-0 collapsible" data-v-27da67de data-v-4d095593><div class="item" role="button" tabindex="0" data-v-4d095593><div class="indicator" data-v-4d095593></div><!----><h2 class="text" data-v-4d095593>驱动相关</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-4d095593><span class="vpi-chevron-right caret-icon" data-v-4d095593></span></div></div><div class="items" data-v-4d095593><!--[--><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-4d095593 data-v-4d095593><div class="item" data-v-4d095593><div class="indicator" data-v-4d095593></div><!----><a class="vp-link no-icon link link" href="/px4code/driver/6h4y4yda/" data-v-4d095593 data-v-85010ec6><!--[--><p class="text" data-v-4d095593>esc_protocol</p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-4d095593 data-v-4d095593><div class="item" data-v-4d095593><div class="indicator" data-v-4d095593></div><!----><a class="vp-link no-icon link link" href="/px4code/driver/faofu83s/" data-v-4d095593 data-v-85010ec6><!--[--><p class="text" data-v-4d095593>Quadrotor Mixer</p><!--]--><!----></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><!--[--><div id="VPContent" vp-content class="vp-content has-sidebar" data-v-72347141 data-v-99ed6822><div class="has-sidebar has-aside vp-doc-container" data-v-33a27419><!--[--><!--]--><div class="container" data-v-33a27419><div class="aside" vp-outline data-v-33a27419><div class="aside-curtain" data-v-33a27419></div><div class="aside-container" data-v-33a27419><div class="aside-content" data-v-33a27419><div class="vp-doc-aside" data-v-33a27419 data-v-9567f56c><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="vp-doc-aside-outline" role="navigation" data-v-9567f56c data-v-a0d6dffc><div class="content" data-v-a0d6dffc><div class="outline-marker" data-v-a0d6dffc></div><div id="doc-outline-aria-label" aria-level="2" class="outline-title" role="heading" data-v-a0d6dffc><span data-v-a0d6dffc>此页内容</span><span class="vpi-print icon" data-v-a0d6dffc></span></div><ul class="root" data-v-a0d6dffc data-v-47b26d4a><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-9567f56c></div><!--[--><!--]--></div></div></div></div><div class="content" data-v-33a27419><div class="content-container" data-v-33a27419><!--[--><!--]--><main class="main" data-v-33a27419><nav class="vp-breadcrumb" data-v-33a27419 data-v-a6e70877><ol vocab="https://schema.org/" typeof="BreadcrumbList" data-v-a6e70877><!--[--><li property="itemListElement" typeof="ListItem" data-v-a6e70877><a class="vp-link no-icon link breadcrumb" href="/" property="item" typeof="WebPage" data-v-a6e70877 data-v-85010ec6><!--[-->首页<!--]--><!----></a><span class="vpi-chevron-right" data-v-a6e70877></span><meta property="position" content="1" data-v-a6e70877></li><li property="itemListElement" typeof="ListItem" data-v-a6e70877><span class="vp-link no-icon breadcrumb" href="/" property="item" typeof="WebPage" data-v-a6e70877 data-v-85010ec6><!--[-->固件修改<!--]--><!----></span><span class="vpi-chevron-right" data-v-a6e70877></span><meta property="position" content="2" data-v-a6e70877></li><li property="itemListElement" typeof="ListItem" data-v-a6e70877><a class="vp-link no-icon link breadcrumb current" href="/px4code/firmware_change/oiyurg2e/" property="item" typeof="WebPage" data-v-a6e70877 data-v-85010ec6><!--[-->固件修改记录<!--]--><!----></a><!----><meta property="position" content="3" data-v-a6e70877></li><!--]--></ol></nav><!--[--><h1 class="vp-doc-title page-title" data-v-8825b5f3>固件修改记录 <!----></h1><div class="vp-doc-meta" data-v-8825b5f3><p class="reading-time" data-v-8825b5f3><span class="vpi-books icon" data-v-8825b5f3></span><span data-v-8825b5f3>741字</span><span data-v-8825b5f3>约2分钟</span></p><!----><p class="create-time" data-v-8825b5f3><span class="vpi-clock icon" data-v-8825b5f3></span><span data-v-8825b5f3>2024-09-07</span></p></div><!--]--><div class="vp-doc plume-content _px4code_firmware_change_oiyurg2e_ external-link-icon-enabled" vp-content data-v-33a27419><h2 id="vins-兼容的修改" tabindex="-1"><a class="header-anchor" href="#vins-兼容的修改"><span>VINS 兼容的修改</span></a></h2><p>为了让VINS数据可用作为vision_pose传给px4的EKF，需要做以下修改</p><div class="vp-tabs"><div class="vp-tabs-nav" role="tablist"><!--[--><button class="active vp-tab-nav" type="button" role="tab" aria-controls="tab-6-0" aria-selected="true"><!--[-->V1.13.3<!--]--></button><button class="vp-tab-nav" type="button" role="tab" aria-controls="tab-6-1" aria-selected="false"><!--[-->V1.15<!--]--></button><!--]--></div><!--[--><div id="tab-6-0" class="active vp-tab" role="tabpanel" aria-expanded="true"><div class="vp-tab-title"><!--[-->V1.13.3<!--]--></div><!--[--><p><code>HIGHRES_IMU</code> 中修改 175 行左右</p><div class="language-c++ line-numbers-mode" data-ext="c++" data-title="c++"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">	// const Vector3f accel = (Vector3f{imu.delta_velocity} * accel_dt_inv);</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">			const</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> Vector3f accel </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> (</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">Vector3f{</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">imu</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">delta_velocity</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">} </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">*</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> accel_dt_inv</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> -</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> accel_bias</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>修改 181 行左右</p><div class="language-c++ line-numbers-mode" data-ext="c++" data-title="c++"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">const</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> Vector3f gyro </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> (</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">Vector3f{</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">imu</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">delta_angle</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">} </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">*</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> gyro_dt_inv</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> -</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> gyro_bias</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">// const Vector3f gyro = (Vector3f{imu.delta_angle} * gyro_dt_inv);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><code>Ekf::fuse</code> 中注释掉 <code>delta_ang_bias</code> 和 <code>delta_vel_bias</code></p><div class="language-c++ line-numbers-mode" data-ext="c++" data-title="c++"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">void</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> Ekf</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">::</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">fuse</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">const</span><span style="--shiki-light:#2E8F82;--shiki-dark:#5DA994;"> Vector24f</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> &amp;</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">K</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> float</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> innovation</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">	_state</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">quat_nominal</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> -=</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> K</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">slice</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&lt;</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">4</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 1</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&gt;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">0</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 0</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> *</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> innovation</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">	_state</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">quat_nominal</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">normalize</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">();</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">	_state</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">vel</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> -=</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> K</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">slice</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&lt;</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">3</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 1</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&gt;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">4</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 0</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> *</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> innovation</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">	_state</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">pos</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> -=</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> K</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">slice</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&lt;</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">3</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 1</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&gt;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">7</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 0</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> *</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> innovation</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">	// _state.delta_ang_bias -= K.slice&lt;3, 1&gt;(10, 0) * innovation;</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">	// _state.delta_vel_bias -= K.slice&lt;3, 1&gt;(13, 0) * innovation;</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">	_state</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">mag_I</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> -=</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> K</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">slice</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&lt;</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">3</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 1</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&gt;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">16</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 0</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> *</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> innovation</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">	_state</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">mag_B</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> -=</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> K</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">slice</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&lt;</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">3</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 1</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&gt;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">19</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 0</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> *</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> innovation</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">	_state</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">wind_vel</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> -=</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> K</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">slice</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&lt;</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">2</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 1</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&gt;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">22</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 0</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> *</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> innovation</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><div id="tab-6-1" class="vp-tab" role="tabpanel" aria-expanded="false"><div class="vp-tab-title"><!--[-->V1.15<!--]--></div><!--[--><div class="hint-container warning"><p class="hint-container-title">TODO</p></div><p>在ekf_help.cpp 下的 void Ekf::fuse(const VectorState &amp;K, float innovation) 函数中注释以下内容</p><div class="language-c++ line-numbers-mode" data-ext="c++" data-title="c++"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">// // gyro_bias</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">// _state.gyro_bias = matrix::constrain(_state.gyro_bias - K.slice&lt;State::gyro_bias.dof, 1&gt;(State::gyro_bias.idx,</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">//                                   0) * innovation,</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">//                                   -getGyroBiasLimit(), getGyroBiasLimit());</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">// // accel_bias</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">// _state.accel_bias = matrix::constrain(_state.accel_bias - K.slice&lt;State::accel_bias.dof, 1&gt;(State::accel_bias.idx,</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">//                                    0) * innovation,</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">//                                    -getAccelBiasLimit(), getAccelBiasLimit());</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><!--]--></div><h2 id="mavlink默认回传频率修改" tabindex="-1"><a class="header-anchor" href="#mavlink默认回传频率修改"><span>MAVLINK默认回传频率修改</span></a></h2><p>修改 默认Mavlink部分消息发送频率</p><div class="hint-container info"><p class="hint-container-title">相关信息</p><p>频率修改的位置不同版本有变化,以USB连接为例</p><ul><li>v1.13 MAVLINK_MODE_CONFIG</li><li>v1.15 MAVLINK_MODE_ONBOARD</li></ul></div><div class="vp-tabs"><div class="vp-tabs-nav" role="tablist"><!--[--><button class="active vp-tab-nav" type="button" role="tab" aria-controls="tab-53-0" aria-selected="true"><!--[-->V1.13<!--]--></button><!--]--></div><!--[--><div id="tab-53-0" class="active vp-tab" role="tabpanel" aria-expanded="true"><div class="vp-tab-title"><!--[-->V1.13<!--]--></div><!--[--><p>对于通过usb使用的mavlink,在 mavlink_main.cpp 1688行左右 case MAVLINK_MODE_CONFIG: 中修改对应的频率</p><div class="language-c++ line-numbers-mode" data-ext="c++" data-title="c++"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">configure_stream_local</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">LOCAL_POSITION_NED</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 100.0</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">f</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">);</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">configure_stream_local</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">ATTITUDE_TARGET</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 100.0</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">f</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">);</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">configure_stream_local</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">HIGHRES_IMU</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 200.0</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">f</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">);</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> // 用于VIO获取高频率IMU信息</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><!--]--></div><div class="hint-container warning"><p class="hint-container-title">TODO</p><p>不同 mavlink 模式的区别</p></div><div class="language-c++ line-numbers-mode" data-ext="c++" data-title="c++"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">	enum</span><span style="--shiki-light:#2E8F82;--shiki-dark:#5DA994;"> MAVLINK_MODE</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">		MAVLINK_MODE_NORMAL</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 0</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">		MAVLINK_MODE_CUSTOM</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">		MAVLINK_MODE_ONBOARD</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">		MAVLINK_MODE_OSD</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">		MAVLINK_MODE_MAGIC</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">		MAVLINK_MODE_CONFIG</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">   //注释写的就是usb</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">		MAVLINK_MODE_IRIDIUM</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">		MAVLINK_MODE_MINIMAL</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">		MAVLINK_MODE_EXTVISION</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">		MAVLINK_MODE_EXTVISIONMIN</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">		MAVLINK_MODE_GIMBAL</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">		MAVLINK_MODE_ONBOARD_LOW_BANDWIDTH</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">		MAVLINK_MODE_COUNT</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">	};</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="imu-回报频率修改" tabindex="-1"><a class="header-anchor" href="#imu-回报频率修改"><span>IMU 回报频率修改</span></a></h2><p>在<a class="route-link" href="/px4code/firmware_change/oiyurg2e/#mavlink%E9%BB%98%E8%AE%A4%E5%9B%9E%E4%BC%A0%E9%A2%91%E7%8E%87%E4%BF%AE%E6%94%B9">mavlink默认回传频率修改</a>中修改了<code>HIGHRES_IMU</code>的频率为200hz，但是实际使用时mavros中<code>/mavros/imu/data_raw</code>的接收频率约为168hz，且周期不恒定。</p><p>接下来探究为什么时168Hz，总结起来分为两个部分</p><ol><li>mavlink发送程序 mavlink_main.cpp中限制了最大频率。</li><li>Uorb 中信息发的发布频率。</li></ol><div class="hint-container info"><p class="hint-container-title">相关信息</p><p>Shell 中使用 uorb top 可以看到各个uorb消息的发送频率</p></div><p>消息频率的不稳定一般是mavlink发送程序带来的，如果对稳定有要求所以可以将频率设置为unlimited_rate。</p><p>168 hz的由来</p><blockquote><p>Uorb sensor_combined</p></blockquote><h3 id="_247hz稳定办法" tabindex="-1"><a class="header-anchor" href="#_247hz稳定办法"><span>247hz稳定办法</span></a></h3><p>在 mavlink_main.cpp中</p><div class="language-c++ line-numbers-mode" data-ext="c++" data-title="c++"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">//1466行左右</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">configure_stream_local</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">HIGHRES_IMU</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> unlimited_rate</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>打开QGC修改参数</p><div class="language- line-numbers-mode" data-ext="" data-title=""><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>IMU_INTEG_RATE 250</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_200hz稳定办法" tabindex="-1"><a class="header-anchor" href="#_200hz稳定办法"><span>200hz稳定办法</span></a></h3><p>在 mavlink_main.cpp中</p><div class="language-c++ line-numbers-mode" data-ext="c++" data-title="c++"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">//1466行左右</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">configure_stream_local</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">HIGHRES_IMU</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> unlimited_rate</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>在<code>HIGHRES_IMU.hpp</code>中</p><div class="language-c++ line-numbers-mode" data-ext="c++" data-title="c++"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">// 增加头文件</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">#</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">include</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &lt;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">uORB/topics/vehicle_angular_velocity.h</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">#</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">include</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &lt;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">uORB/topics/vehicle_acceleration.h</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">//73行左右 send函数前 添加</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">uORB</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">::</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">Subscription _vehicle_acc_sub</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">ORB_ID</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">vehicle_acceleration</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)};</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">uORB</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">::</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">Subscription _vehicle_angular_vel_sub</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">ORB_ID</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">vehicle_angular_velocity</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)};</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">vehicle_acceleration_s vehicle_acc</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">vehicle_angular_velocity_s vehicle_angular_vel</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">bool</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> vehicle_acc_updated </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> false</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> vehicle_angular_vel_updated </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> false</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">uint64_t</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> time_usec</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">0</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">};</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">// #define original</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">#</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">ifdef</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> original</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">// 在205行左右};前添加</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">        #</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">else</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> //UAV fast IMU version</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">        bool</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> send</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">()</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> override</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">        {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">                //Check if accel and gyro are updated</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">                if</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> (</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">_vehicle_acc_sub</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">update</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&amp;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">vehicle_acc</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">))</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">                        vehicle_acc_updated </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> true</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">                        time_usec </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> vehicle_acc</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">timestamp_sample</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">                }</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">                if</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> (</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">_vehicle_angular_vel_sub</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">update</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&amp;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">vehicle_angular_vel</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">))</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">                        vehicle_angular_vel_updated </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> true</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">                        time_usec </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> vehicle_angular_vel</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">timestamp_sample</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">                }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">                // if (vehicle_acc_updated &amp;&amp; vehicle_angular_vel_updated) {</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">                if</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> (</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">vehicle_acc_updated</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&amp;&amp;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> vehicle_angular_vel_updated</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">                        vehicle_acc_updated </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> false</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">                        vehicle_angular_vel_updated </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> false</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">                        uint16_t</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> fields_updated </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 0</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">                        fields_updated </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">|=</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> (</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">1</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> &lt;&lt;</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 0</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> |</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> (</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">1</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> &lt;&lt;</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 1</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> |</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> (</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">1</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> &lt;&lt;</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 2</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">);</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> // accel</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">                        fields_updated </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">|=</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> (</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">1</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> &lt;&lt;</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 3</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> |</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> (</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">1</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> &lt;&lt;</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 4</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> |</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> (</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">1</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> &lt;&lt;</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 5</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">);</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> // gyro</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">                        mavlink_highres_imu_t</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> msg</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">{};</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">                        msg</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">time_usec</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> time_usec</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">                        msg</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">xacc</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> vehicle_acc</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">xyz</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">0</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">];</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">                        msg</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">yacc</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> vehicle_acc</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">xyz</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">1</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">];</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">                        msg</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">zacc</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> vehicle_acc</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">xyz</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">2</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">];</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">                        msg</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">xgyro</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> vehicle_angular_vel</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">xyz</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">0</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">];</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">                        msg</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">ygyro</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> vehicle_angular_vel</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">xyz</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">1</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">];</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">                        msg</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">zgyro</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> vehicle_angular_vel</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">xyz</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">2</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">];</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">                        msg</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">fields_updated</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> fields_updated</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">                        mavlink_msg_highres_imu_send_struct</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">_mavlink</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">-&gt;</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">get_channel</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(),</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> &amp;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">msg</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">);</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">                        return</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> true</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">                }</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">                return</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> false</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">        }</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">#</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">endif</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div></main><footer class="vp-doc-footer" data-v-33a27419 data-v-56d927e6><!--[--><!--]--><!----><div class="contributors" data-v-56d927e6><span class="contributors-label" data-v-56d927e6>贡献者: </span><span class="contributors-info" data-v-56d927e6><!--[--><!--[--><span class="contributor" data-v-56d927e6>hyaline-wang</span><!----><!--]--><!--]--></span></div><nav class="prev-next" data-v-56d927e6><div class="pager" data-v-56d927e6><a class="vp-link no-icon link pager-link prev" href="/px4code/wno3ydw8/" data-v-56d927e6 data-v-85010ec6><!--[--><span class="desc" data-v-56d927e6>上一页</span><span class="title" data-v-56d927e6>构建px4 docker环境</span><!--]--><!----></a></div><div class="pager" data-v-56d927e6><a class="vp-link no-icon link pager-link next" href="/px4code/controller/iejazgwj/" data-v-56d927e6 data-v-85010ec6><!--[--><span class="desc" data-v-56d927e6>下一页</span><span class="title" data-v-56d927e6>AttiControl</span><!--]--><!----></a></div></nav></footer><!----><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!--]--><button style="display:none;" type="button" class="vp-back-to-top" aria-label="back to top" data-v-72347141 data-v-7d6cdfc4><span class="percent" data-allow-mismatch data-v-7d6cdfc4>0%</span><span class="show icon vpi-back-to-top" data-v-7d6cdfc4></span><svg aria-hidden="true" data-v-7d6cdfc4><circle cx="50%" cy="50%" data-allow-mismatch style="stroke-dasharray:calc(0% - 12.566370614359172px) calc(314.1592653589793% - 12.566370614359172px);" data-v-7d6cdfc4></circle></svg></button><footer class="vp-footer has-sidebar" vp-footer data-v-72347141 data-v-0c1ab491><div class="container" data-v-0c1ab491><p class="message" data-v-0c1ab491>Powered by <a target="_blank" href="https://v2.vuepress.vuejs.org/">VuePress</a> & <a target="_blank" href="https://theme-plume.vuejs.press">vuepress-theme-plume</a></p><!----></div></footer><!--[--><!--]--><!--]--></div><!--[--><!--]--><!--]--></div><script type="module" src="/assets/app-vo1rYq2c.js" defer></script></body></html>